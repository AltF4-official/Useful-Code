<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sand Saga â€” Falling Sand Sandbox & Campaign</title>
<link rel="stylesheet" href="styles.css">
<!-- Inline fallback JSON for immediate local open (keeps running file://). External files also provided. -->
<script id="materials-embedded" type="application/json">
<!-- Embedded snapshot of materials.json (used if external fetch fails) -->
{}
</script>
<script id="levels-embedded" type="application/json">
<!-- Embedded snapshot of levels.json (used if external fetch fails) -->
{}
</script>
</head>
<body>
<header class="topbar" role="banner">
  <div class="brand">Sand Saga</div>
  <nav class="topnav" role="navigation" aria-label="Main">
    <button id="btnSandbox" class="navbtn" title="Sandbox Mode">Sandbox</button>
    <button id="btnCampaign" class="navbtn" title="Campaign Mode">Campaign</button>
    <div class="navspacer"></div>
    <button id="btnHelp" class="navbtn" title="Help (F1)">Help</button>
    <button id="btnExportPNG" class="navbtn" title="Export PNG">Export PNG</button>
    <button id="btnSaveWorld" class="navbtn" title="Save world">Save</button>
    <button id="btnLoadWorld" class="navbtn" title="Load world">Load</button>
    <button id="btnMute" class="navbtn" title="Mute">ðŸ”ˆ</button>
  </nav>
</header>

<main class="main">
  <aside class="leftpane" id="leftPane" aria-label="Tools and Materials">
    <section class="panel" id="materialsPanel">
      <header>Materials</header>
      <div id="materialsGrid" class="materials-grid" aria-live="polite"></div>
      <div class="materials-meta">
        <label>Quick select keys: <input id="quickKeys" type="text" value="1-9"/></label>
      </div>
    </section>

    <section class="panel" id="toolsPanel">
      <header>Brush & Tools</header>
      <div id="toolsGrid" class="tools-grid"></div>
    </section>

    <section class="panel" id="presetsPanel">
      <header>Presets</header>
      <div id="presetsList"></div>
      <div class="preset-actions">
        <input id="presetName" placeholder="Preset name" />
        <button id="savePreset">Save Preset</button>
        <button id="applyPreset">Apply</button>
      </div>
    </section>
  </aside>

  <section class="canvas-wrap" id="canvasWrap">
    <div class="canvas-toolbar">
      <div>
        <label>Mode: <select id="modeSelect"><option value="sandbox">Sandbox</option><option value="campaign">Campaign</option></select></label>
        <label>Grid: <select id="resolutionSelect"><option value="400x300">400Ã—300</option><option value="300x200">300Ã—200</option><option value="200x150">200Ã—150</option></select></label>
      </div>
      <div>
        <button id="playPause">Pause</button>
        <button id="stepBtn">Step</button>
        <label>Speed: <input id="speedRange" type="range" min="0.25" max="4" step="0.25" value="1"></label>
      </div>
    </div>

    <div id="canvasContainer" class="canvas-container">
      <canvas id="worldCanvas" width="800" height="600" tabindex="0" aria-label="Simulation canvas"></canvas>
    </div>

    <div class="bottombar" id="bottomBar" role="status" aria-live="polite">
      <div id="statusText">Ready</div>
      <div id="perfText">FPS: -- | Tick: --</div>
      <div id="seedText">Seed: 0</div>
    </div>
  </section>

  <aside class="rightpane" id="rightPane" aria-label="Inspector & Simulation">
    <section class="panel" id="simPanel">
      <header>Simulation Controls</header>
      <div class="ctrl-row">
        <label><input type="checkbox" id="toggleGravity" checked> Gravity</label>
        <label><input type="checkbox" id="toggleTemp" checked> Temperature</label>
        <label><input type="checkbox" id="togglePressure"> Pressure</label>
      </div>
      <div class="ctrl-row">
        <label>Heater: <input id="heaterPower" type="range" min="0" max="1" step="0.01" value="0.2"></label>
        <label>Fan Strength: <input id="fanPower" type="range" min="0" max="1" step="0.01" value="0.1"></label>
      </div>
      <div class="ctrl-row">
        <label>Chunk Size: <select id="chunkSize"><option>16</option><option>32</option><option>64</option></select></label>
        <label>FPS cap: <input id="fpsCap" type="number" min="15" max="240" value="60"></label>
      </div>
      <div class="accordion" id="advancedSim">
        <button class="acc-btn">Advanced</button>
        <div class="acc-body"></div>
      </div>
    </section>

    <section class="panel" id="campaignPanel" hidden>
      <header>Campaign</header>
      <div id="levelGrid" class="level-grid"></div>
      <div id="levelInfo"></div>
      <div class="campaign-actions">
        <button id="retryLevel">Retry</button>
        <button id="nextLevel">Next</button>
        <button id="resetProgress">Reset Progress</button>
      </div>
    </section>

    <section class="panel" id="debugPanel">
      <header>Debug & Tools</header>
      <div><label><input type="checkbox" id="showHeatmap"> Heatmap</label></div>
      <div><label><input type="checkbox" id="showPressure"> Pressure Map</label></div>
      <div><label><input type="checkbox" id="showGrid"> Cell Borders</label></div>
      <div id="debugConsole" class="console"></div>
    </section>
  </aside>
</main>

<!-- Icons sprite -->
<div style="display:none" id="iconsSVG" aria-hidden="true">
  <!-- icons.svg will be in the project root; inlined here for immediate use -->
  <!-- Placeholder - real icons defined in icons.svg file block below -->
</div>

<!-- Help / Hotkeys overlay -->
<div id="helpOverlay" class="overlay" hidden>
  <div class="overlay-inner">
    <h2>Help & Hotkeys</h2>
    <ul>
      <li>WASD or drag: Pan. Mouse wheel or Q/E: Zoom.</li>
      <li>1â€“9: quick material select. Space: Pause. . : Step.</li>
      <li>[ ]: brush size. Ctrl+Z / Ctrl+Y: Undo/Redo. F1: Help.</li>
    </ul>
    <button id="closeHelp">Close</button>
  </div>
</div>

<script>
/*
  At runtime the engine will attempt to fetch external materials.json and levels.json.
  If that fails (common when opening file://), it falls back to the embedded JSON below
  which is populated by the server-side files included in the project.
*/
(function(){
  // Helper to insert embedded json from file blocks below (replaced at top of HTML by build)
  const materialsEmbed = document.getElementById('materials-embedded');
  const levelsEmbed = document.getElementById('levels-embedded');

  // If these script tags are still empty, populate them with the separate files' content
  // (game.js will fallback to fetch external files if present).
  // For local runs we keep them empty here; game.js will handle fallback gracefully.
})();
</script>

<script src="game.js"></script>
</body>
</html>
